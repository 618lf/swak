(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4dd7"],{"149a":function(a,t,e){},"498d":function(a,t,e){},5503:function(a,t,e){"use strict";var s=e("8174"),i=e.n(s);i.a},"65ab":function(a,t,e){"use strict";var s=e("498d"),i=e.n(s);i.a},"816d":function(a,t,e){},8174:function(a,t,e){},"95db":function(a,t,e){"use strict";e.r(t);var s=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"tax-page tempate-cfg"},[e("h4",[a._v("模板管理"),e("span",[a._v("/")]),a._v(a._s(this.template.templateTypeName))]),e("div",{staticClass:"content"},[e("div",{staticClass:"fill-info"},[e("div",{staticClass:"title"},[a._v("模板创建说明：")]),e("div",{staticClass:"info"},[e("p",[a._v("1.为了能正确的导入支付报表且正确的计算税率，请根据实际的支付报表的Excel来配置模板")]),e("p",[a._v("2.系统会默认显示一张初始化的模板，可以操作“新增、删除”来修改。点击“"),e("a",{on:{click:function(t){return t.stopPropagation(),a.useDefault(t)}}},[a._v("恢复默认")]),a._v("”可以恢复到默认状态")]),e("p",[a._v("3.点击每行后面的“新增、删除”来添加和删除项目")]),e("p",[a._v("4.填入支付项目名称，系统会推送相应税法标准的“薪酬项目”， 点击“薪酬项目”可以看到相应的税法解释")]),e("p",[a._v("5.如果推送的不准确，请点击按钮“请选择”选择适合的“薪酬项目”")])])]),e("table",{staticClass:"table sample-table table-bordered"},[a._m(0),e("tbody",a._l(this.mappings,function(t,s){return e("tr",{key:t.columnIndex},[e("td",{staticClass:"td-tc"},[a._v(a._s(t.columnIndex))]),e("td",{staticClass:"td-text"},[e("el-autocomplete",{staticClass:"td-text_input",attrs:{placeholder:"填入支付报表中的项目名称","fetch-suggestions":a.doSearchSalary},on:{focus:function(t){a.searchSalary(s)},select:a.selectSalary},scopedSlots:a._u([{key:"default",fn:function(t){var s=t.item;return[e("div",{staticClass:"salary-name"},[a._v(a._s(s.name))]),e("span",{staticClass:"salary-salarys"},[a._v(a._s(s.descs))])]}}]),model:{value:t.columnName,callback:function(e){a.$set(t,"columnName",e)},expression:"item.columnName"}},[e("i",{staticClass:"el-icon-edit el-input__icon",attrs:{slot:"suffix"},on:{click:function(t){a.querySalary(s)}},slot:"suffix"})])],1),e("td",{staticClass:"td-salary"},[t.salary&&!t.salaryParam?e("a",{staticClass:"salary",attrs:{"data-id":t.salary.id},on:{click:function(t){return t.stopPropagation(),a.showSalary(t)}}},[e("span",{staticClass:"-name"},[a._v(a._s(t.salaryName))]),e("span",{staticClass:"-descs"},[a._v(a._s(t.salary.descs))])]):a._e(),t.salary&&t.salaryParam?e("a",{staticClass:"salary",attrs:{"data-id":t.salary.id},on:{click:function(t){return t.stopPropagation(),a.showSalary(t)}}},[e("span",{staticClass:"-name"},[a._v(a._s(t.salaryName)+" / "+a._s(t.salaryParam.paramName))]),e("span",{staticClass:"-descs"},[a._v(a._s(t.salaryParam.paramDesc))])]):a._e()]),e("td",{staticClass:"td-ops"},[e("a",{on:{click:function(t){t.stopPropagation(),a.addMapping(s)}}},[a._v("插入")]),e("a",{on:{click:function(t){t.stopPropagation(),a.delMapping(s)}}},[a._v("删除")])])])}))]),e("div",{staticClass:"ops-wrap"},[e("el-button",{attrs:{type:"primary",loading:a.saveLoading},on:{click:function(t){return t.stopPropagation(),a.doSave(t)}}},[a._v("保存")]),e("el-button",{attrs:{type:"success"},on:{click:function(t){return t.stopPropagation(),a.useDefault(t)}}},[a._v("恢复默认")]),e("swak-link",{staticClass:"el-button",attrs:{to:"/func/template"}},[a._v("返回")])],1)]),e("salary-view",{attrs:{visible:a.salaryDialog.visible,id:a.salaryDialog.id},on:{"update:visible":function(t){a.$set(a.salaryDialog,"visible",t)},"update:id":function(t){a.$set(a.salaryDialog,"id",t)}}}),e("salary-select",{attrs:{visible:a.selectDialog.visible},on:{"update:visible":function(t){a.$set(a.selectDialog,"visible",t)},"select:salary":a.selectSalary}}),e("template-name",{attrs:{visible:a.nameDialog.visible,name:a.nameDialog.name},on:{"update:visible":function(t){a.$set(a.nameDialog,"visible",t)},"name:update":a.updateName}})],1)},i=[function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("thead",[e("tr",[e("th",{attrs:{scope:"col",width:"40"}},[a._v("序号")]),e("th",{attrs:{scope:"col",width:"220"}},[a._v("支付项目"),e("span",{staticClass:"red"},[a._v("*")])]),e("th",{attrs:{scope:"col"}},[a._v("薪酬项目")]),e("th",{attrs:{scope:"col",width:"100"}},[a._v("操作")])])])}],l=(e("a481"),e("7f7f"),e("ac6a"),e("882d")),n=e("9c18"),r=e("e1d2"),o={get:function(a){return Object(r["a"])({url:"/api/user/salary/get/"+a,method:"get"})},list:function(a){return Object(r["a"])({url:"/api/user/salary/list",method:"get"})}},c=o,u=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"user-table-select"},[e("el-dialog",{attrs:{title:"薪酬项目： "+this.salary.name,visible:a.visible,"before-close":a.doCancel},on:{"update:visible":function(t){a.visible=t}}},[e("div",{staticClass:"salary"},[e("div",{staticClass:"item"},[e("label",[a._v("项目名称")]),e("div",[a._v(a._s(this.salary.name))])]),e("div",{staticClass:"item"},[e("label",[a._v("项目描述")]),e("div",[a._v(a._s(this.salary.descs))])]),this.salary.payItem?e("div",{staticClass:"item"},[e("label",[a._v("税法解释")]),e("div",[a._v(a._s(this.salary.payItem.subjectDesc))])]):a._e(),this.salary.payItem?e("div",{staticClass:"item"},[e("label",[a._v("税法依据")]),e("div",[a._v(a._s(this.salary.payItem.subjectTax))])]):a._e()])])],1)},p=[],d={name:"salary-view",data:function(){return{salary:{}}},props:{visible:{type:Boolean,default:!1},id:{type:String,default:null}},watch:{id:function(){this.getSalary()}},methods:{getSalary:function(){var a=this;this.id&&c.get(this.id).then(function(t){a.salary=t.obj})},doCancel:function(){this.$emit("update:visible",!1)}}},m=d,f=(e("e4c8"),e("2877")),v=Object(f["a"])(m,u,p,!1,null,"4dc48c2c",null);v.options.__file="salaryView.vue";var y=v.exports,h=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"user-table-select"},[e("el-dialog",{attrs:{title:"选择薪酬项目",visible:a.visible,"before-close":a.doCancel},on:{"update:visible":function(t){a.visible=t}}},[e("div",{staticClass:"fill-info"},[e("div",{staticClass:"title"},[a._v("项目类型说明：")]),e("div",{staticClass:"info"},[e("p",[a._v("1.基本项目是指员工信息，计税结果等信息")]),e("p",[a._v("2.薪酬项目是指税法规定的支付项目")])])]),e("el-tabs",{attrs:{type:"border-card"},model:{value:a.activeName,callback:function(t){a.activeName=t},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"薪酬项目",name:"first"}},a._l(this.salarys,function(t){return"PAY_ITEM"==t.salaryType?e("a",{staticClass:"salary",attrs:{"data-id":t.index},on:{click:function(t){return t.stopPropagation(),a.selectSalary(t)}}},[e("span",{staticClass:"name"},[a._v(a._s(t.name))]),e("span",{staticClass:"descs"},[a._v(a._s(t.descs))])]):a._e()})),e("el-tab-pane",{attrs:{label:"基本项目",name:"second"}},a._l(this.salarys,function(t){return"PAY_ITEM"!=t.salaryType?e("a",{staticClass:"salary",attrs:{"data-id":t.index},on:{click:function(t){return t.stopPropagation(),a.selectSalary(t)}}},[e("span",{staticClass:"name"},[a._v(a._s(t.name))]),e("span",{staticClass:"descs"},[a._v(a._s(t.descs))])]):a._e()}))],1)],1)],1)},b=[],_={name:"salary-select",data:function(){return{activeName:"first",salarys:[]}},props:{visible:{type:Boolean,default:!1}},mounted:function(){this.loadSalarys()},methods:{doCancel:function(){this.$emit("update:visible",!1)},loadSalarys:function(){var a=this;c.list().then(function(t){a.salarys=t.obj})},selectSalary:function(a){for(var t=a.currentTarget.getAttribute("data-id"),e=null,s=0;s<this.salarys.length;s++)if(this.salarys[s].index==t){e=this.salarys[s];break}this.$emit("update:visible",!1),this.$emit("select:salary",e)}}},g=_,C=(e("5503"),Object(f["a"])(g,h,b,!1,null,"6bc58bd4",null));C.options.__file="salarySelect.vue";var S=C.exports,x=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"user-table-select"},[e("el-dialog",{attrs:{title:"填入模板名称",visible:a.visible,"before-close":a.doCancel},on:{"update:visible":function(t){a.visible=t}}},[e("div",{staticClass:"salary"},[e("div",{staticClass:"item"},[e("label",[a._v("模板名称")]),e("div",[e("el-input",{attrs:{placeholder:"模板名称"},model:{value:a.templateName,callback:function(t){a.templateName=t},expression:"templateName"}})],1)])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:a.doCancel}},[a._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:a.doConfirm}},[a._v("确 定")])],1)])],1)},N=[],I={name:"template-name",data:function(){return{templateName:""}},props:{visible:{type:Boolean,default:!1},name:{type:String,default:""}},watch:{name:function(){this.templateName=this.name}},methods:{doCancel:function(){this.$emit("update:visible",!1)},doConfirm:function(){this.templateName?(this.$emit("name:update",this.templateName),this.doCancel()):this.$message.error("请填入模板名称")}}},A=I,T=(e("65ab"),Object(f["a"])(A,x,N,!1,null,"ac3b84ac",null));T.options.__file="templateName.vue";var j=T.exports,P={components:{TemplateName:j,SalarySelect:S,SalaryView:y,SwakLink:l["a"]},name:"templateCfg",data:function(){return{indexs:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT"],template:{},mappings:[],salarys:[],editable:{},salaryDialog:{visible:!1,id:null},selectDialog:{visible:!1,id:null},nameDialog:{visible:!1,name:""},saveLoading:!1}},mounted:function(){this.$emit("layout:load","template");var a=this.$route.query.type,t=this.$route.params.id;this.getById(t),this.getByType(a),this.salarys=this.loadSalarys()},methods:{getByType:function(a){var t=this;a&&n["a"].def(a).then(function(a){t.template=a.obj||{},t.mappings=a.obj.mappings,t.sortIndex()})},getById:function(a){var t=this;a&&n["a"].get(a).then(function(a){t.template=a.obj,t.mappings=a.obj.mappings})},addMapping:function(a){this._add(a)},delMapping:function(a){this.mappings.splice(a,1),0==this.mappings.length?this._add(0):this.sortIndex()},_add:function(a,t){this.mappings.splice(a+1,0,t||{}),this.sortIndex()},sortIndex:function(){var a=this;this.mappings.forEach(function(t,e){t.columnIndex=a.indexs[e]})},useDefault:function(){var a=this,t=this.template.templeteType;t?n["a"].def(t).then(function(t){a.template=t.obj||{},a.mappings=t.obj.mappings,a.sortIndex()}):this.$notify.error("模板错误！")},searchSalary:function(a){this.editable=this.mappings[a],this.editable.index=a},doSearchSalary:function(a,t){this.editable.bakColumnName=a;var e=this.salarys,s=a?e.filter(this.createStateFilter(a)):e;t(s)},createStateFilter:function(a){return function(t){var e=t.name+","+t.salarys;return-1!=e.indexOf(a)}},selectSalary:function(a){this.editable.columnName=this.editable.bakColumnName||a.name,this.editable.salary=a,this.editable.salaryParam=null,this.editable.payItemId=a.id,this.editable.salaryName=a.name,this.editable.payItemParam="",this.editable.columnType=a.salaryType,this.addSalaryParam()},addSalaryParam:function(){var a=this,t=this.editable.salary;if(t.payItem&&t.payItem.params&&t.payItem.params.length>0){var e=t.payItem.params;e.forEach(function(e){"IMPORT"==e.paramType&&a._add(a.editable.index,{columnName:e.paramName,columnType:"PAY_PARAM",payItemId:t.id,salaryName:t.name,payItemParam:e.id,salary:t,salaryParam:{id:e.id,paramName:e.paramName,paramDesc:e.paramDesc}})})}},querySalary:function(a){this.searchSalary(a),this.selectDialog.visible=!0},loadSalarys:function(){var a=this;c.list().then(function(t){a.salarys=t.obj})},showSalary:function(a){var t=a.currentTarget.getAttribute("data-id");t&&(this.salaryDialog.visible=!0,this.salaryDialog.id=t)},doSave:function(){var a=this,t=!0;this.mappings.forEach(function(e){(null==e.columnName||null==e.salary&&null==e.columnType)&&(t=!1,setTimeout(function(){a.$notify.error({title:"错误",message:"列"+e.columnIndex+"未配置完成"})},100))}),t&&(this.template.multiAble?(this.nameDialog.visible=!0,this.nameDialog.name=this.template.templateName):this._doSave())},updateName:function(a){this.template.templateName=a,this._doSave()},_doSave:function(){var a=this;this.saveLoading=!0;var t=[];this.mappings.forEach(function(a){t.push({id:a.id,columnName:a.columnName,columnIndex:a.columnIndex,columnType:a.columnType,flexFiled:a.flexFiled,payItemId:a.salary?a.salary.id:"",salaryName:a.salaryName,payItemParam:a.salaryParam?a.salaryParam.id:""})});var e={id:this.template.id,templateName:this.template.templateName,templeteType:this.template.templeteType,json_mapping:JSON.stringify(t)};n["a"].save(e).then(function(t){a.saveLoading=!1;var s=t.obj;s.success?a._endSave(s):a.$confirm(s.message,"提醒",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.saveLoading=!0,n["a"].forceSave(e).then(function(t){a.saveLoading=!1,a._endSave(t.obj)})}).catch(function(){})})},_endSave:function(a){this.$notify.success({title:"操作提醒",message:"模板保存成功"}),this.template.id?this.getById(this.template.id):this.$router.replace("/func/template/cfg/"+a.message)}}},k=P,D=(e("e3b7"),Object(f["a"])(k,s,i,!1,null,"5f1e918c",null));D.options.__file="templateCfg.vue";t["default"]=D.exports},"9c18":function(a,t,e){"use strict";var s=e("e1d2"),i={list:function(){return Object(s["a"])({url:"/api/user/template/list",method:"get"})},tools:function(){return Object(s["a"])({url:"/api/user/template/tools",method:"get"})},def:function(a){return Object(s["a"])({url:"/api/user/template/def?type="+a,method:"get"})},get:function(a){return Object(s["a"])({url:"/api/user/template/get/"+a,method:"get"})},save:function(a){return Object(s["a"])({url:"/api/user/template/save",method:"post",data:a})},forceSave:function(a){return Object(s["a"])({url:"/api/user/template/forceSave",method:"post",data:a})},xml:function(){return Object(s["a"])({url:"/api/user/template/xml",method:"post",responseType:"blob",data:{}})},excel:function(){return Object(s["a"])({url:"/api/user/template/excel",method:"post",responseType:"blob"})},excelOne:function(a){return Object(s["a"])({url:"/api/user/template/excel/"+a,method:"post",responseType:"blob"})}};t["a"]=i},e3b7:function(a,t,e){"use strict";var s=e("816d"),i=e.n(s);i.a},e4c8:function(a,t,e){"use strict";var s=e("149a"),i=e.n(s);i.a}}]);
//# sourceMappingURL=chunk-4dd7.f61fea57.js.map